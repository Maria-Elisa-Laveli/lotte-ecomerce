const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const bodyParser = require('body-parser');
require('dotenv').config();

// Inicializa o app express
const app = express();

// Middleware
app.use(cors());
app.use(bodyParser.json()); // Permite envio de JSON no corpo das requisi√ß√µes

// Conectar ao MongoDB
mongoose.connect(process.env.MONGO_URI)
  .then(() => console.log('‚úÖ Conectado ao MongoDB'))
  .catch((err) => console.log('‚ùå Erro ao conectar ao MongoDB:', err));

// Definir o esquema do produto
const productSchema = new mongoose.Schema({
  name: String,
  brand: String,
  price: Number,
  stock: Number,
  volume: String,
  category: String,
  description: String,
  image: String
});

// Criar o modelo de produto
const Product = mongoose.model('Product', productSchema);

// üü¢ Adicionar produto
app.post('/api/products', async (req, res) => {
  try {
    console.log('Produto recebido:', req.body);
    const newProduct = new Product(req.body);
    await newProduct.save();
    console.log('Produto salvo no banco:', newProduct);
    res.status(201).json({ message: 'Produto adicionado com sucesso!' });
  } catch (error) {
    console.error('Erro ao salvar produto:', error);
    res.status(500).json({ error: 'Erro ao adicionar o produto.' });
  }
});

// üîµ Listar produtos
app.get('/api/products', async (req, res) => {
  try {
    const products = await Product.find();
    res.status(200).json(products);
  } catch (error) {
    console.error('Erro ao buscar produtos:', error);
    res.status(500).json({ error: 'Erro ao buscar os produtos.' });
  }
});

// üü† Editar produto
app.put('/api/products/:id', async (req, res) => {
  try {
    const updatedProduct = await Product.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true }
    );

    if (!updatedProduct) {
      return res.status(404).json({ error: 'Produto n√£o encontrado.' });
    }

    res.status(200).json({
      message: 'Produto atualizado com sucesso!',
      product: updatedProduct,
    });
  } catch (error) {
    console.error('Erro ao atualizar produto:', error);
    res.status(500).json({ error: 'Erro ao atualizar o produto.' });
  }
});

// üî¥ Excluir produto
app.delete('/api/products/:id', async (req, res) => {
  try {
    const deletedProduct = await Product.findByIdAndDelete(req.params.id);

    if (!deletedProduct) {
      return res.status(404).json({ error: 'Produto n√£o encontrado.' });
    }

    res.status(200).json({ message: 'Produto exclu√≠do com sucesso!' });
  } catch (error) {
    console.error('Erro ao excluir produto:', error);
    res.status(500).json({ error: 'Erro ao excluir o produto.' });
  }
});

// Porta do servidor
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
  console.log(`üöÄ Servidor rodando na porta ${PORT}`);
});




email: { type: String, required: true, unique: true },
  senha: { type: String, required: true },
  resetToken: String,
  resetTokenExpiration: Date,

  perfil sem foto:
  <!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meu Perfil - L‚Äôotte</title>
  <link rel="stylesheet" href="css/perfil.css" />
  <style>
    /* Estilos b√°sicos para exibi√ß√£o dos dados */
    .profile-container {
      display: flex;
      min-height: 100vh;
      font-family: Arial, sans-serif;
    }

    

   
    .sidebar {
      width: 250px;
      background-color: #ffb3b3;
      padding: 20px;
      text-align: center;
    }
    
    .photo-section img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
    }
    .upload-label {
      display: inline-block;
      margin-top: 10px;
      cursor: pointer;
      color: #ffffff;
      font-size: 14px;
    }
    .main-content {
      flex: 1;
      padding: 30px;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      background-color: #eee;
      border-radius: 5px;
      transition: 0.2s;
    }
    .tab.active {
      background-color: #007bff;
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .inputbox {
      margin-bottom: 15px;
    }
    .titu {
      color: rgb(254, 198, 112);
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
   .inputbox p {
  background-color: #f0f0f0;
  padding: 10px 12px;   /* espa√ßo interno para n√£o encostar no texto */
  border-radius: 5px;
  margin: 0;
  color: #333;          /* cor do texto */
  min-height: 40px;     /* garante altura m√≠nima para o campo */
  line-height: 1.4;     /* altura da linha */
}

h3{color: rgb(254, 198, 112);}

  </style>
</head>
<body>
  <div class="profile-container">
    <!-- Sidebar com foto e nome -->
    <aside class="sidebar">
      <div class="in">
         <div class="photo-section">
       
        
      </div>
      </div>
     
      <h2 id="usernameDisplay">Usu√°rio</h2>
      <p id="emailDisplay">email@exemplo.com</p>
    </aside>

    <!-- Conte√∫do principal -->
    <main class="main-content">
      <nav class="tabs">
        <button class="tab active" data-tab="perfil">Perfil</button>
        <button class="tab" data-tab="favoritos">Favoritos</button>
        <button class="tab" data-tab="carrinho">Carrinho</button>
      </nav>

      <!-- Aba: Perfil -->
      <section id="perfil" class="tab-content active">
        <h3>Meus Dados</h3>
        <br>
                  <label class="titu"><b>Nome Completo</b></label>
        <div class="inputbox">

          <p id="nomeDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Telefone</b></label>
        <div class="inputbox">
       
          <p id="telefoneDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Cidade</b></label>
        <div class="inputbox">
       
          <p id="cidadeDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Estado</b></label>
        <div class="inputbox">
       
          <p id="estadoDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Endere√ßo</b></label>
        <div class="inputbox">
       
          <p id="enderecoDisplay">Carregando...</p>
        </div>
      </section>

      <!-- Aba: Favoritos -->
      <section id="favoritos" class="tab-content">
        <h3>Favoritos</h3>
        <div id="favoritosList">Nenhum produto favoritado ainda.</div>
      </section>

      <!-- Aba: Carrinho -->
      <section id="carrinho" class="tab-content">
        <h3>Meu Carrinho</h3>
        <div id="carrinhoList">Seu carrinho est√° vazio.</div>
      </section>
    </main>
  </div>

  <script>
    // Alternar abas
    document.querySelectorAll(".tab").forEach((tab) => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach((t) => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach((c) => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });

    async function carregarPerfil() {
      try {
        const email = localStorage.getItem("userEmail");

        if (!email) {
          alert("Usu√°rio n√£o autenticado! Fa√ßa login novamente.");
          window.location.href = "login.html";
          return;
        }

        const resposta = await fetch(`http://localhost:3000/perfil/${email}`);
        if (!resposta.ok) throw new Error("Erro ao buscar dados do usu√°rio.");

        const usuario = await resposta.json();

        document.getElementById("usernameDisplay").textContent = usuario.username || "Usu√°rio";
        document.getElementById("emailDisplay").textContent = usuario.email || "E-mail n√£o informado";
        document.getElementById("nomeDisplay").textContent = usuario.nome || "-";
        document.getElementById("telefoneDisplay").textContent = usuario.telefone || "-";
        document.getElementById("cidadeDisplay").textContent = usuario.cidade || "-";
        document.getElementById("estadoDisplay").textContent = usuario.estado || "-";
        document.getElementById("enderecoDisplay").textContent = usuario.endereco || "-";

        document.getElementById("profilePhoto").src = usuario.fotoPerfil || "img/default-avatar.png";
      } catch (err) {
        console.error("Erro ao carregar perfil:", err);
      
      }
    }

    // Upload de foto
    
    window.onload = carregarPerfil;
  </script>
</body>
</html>


perfil com foto: <!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meu Perfil - L‚Äôotte</title>
  <link rel="stylesheet" href="css/perfil.css" />
  <style>
    /* Estilos b√°sicos para exibi√ß√£o dos dados */
    .profile-container {
      display: flex;
      min-height: 100vh;
      font-family: Arial, sans-serif;
    }

    .in{color:#ffb3b3 ;}

   
    .sidebar {
      width: 250px;
      background-color: #ffb3b3;
      padding: 20px;
      text-align: center;
    }
    
    .photo-section img {
      color: #ffb3b3;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
    }
    .upload-label {
      display: inline-block;
      margin-top: 10px;
      cursor: pointer;
      color: #ffffff;
      font-size: 14px;
    }
    .main-content {
      flex: 1;
      padding: 30px;
    }
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      background-color: #eee;
      border-radius: 5px;
      transition: 0.2s;
    }
    .tab.active {
      background-color: #007bff;
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .inputbox {
      margin-bottom: 15px;
    }
    .titu {
      color: rgb(254, 198, 112);
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
   .inputbox p {
  background-color: #f0f0f0;
  padding: 10px 12px;   /* espa√ßo interno para n√£o encostar no texto */
  border-radius: 5px;
  margin: 0;
  color: #333;          /* cor do texto */
  min-height: 40px;     /* garante altura m√≠nima para o campo */
  line-height: 1.4;     /* altura da linha */
}

h3{color: rgb(254, 198, 112);}

  </style>
</head>
<body>
  <div class="profile-container">
    <!-- Sidebar com foto e nome -->
    <aside class="sidebar">
      <div class="in">
         <div class="photo-section">
        <img id="profilePhoto" src="img/default-avatar.png" alt="Foto de perfil" />
        <label for="photoUpload" class="upload-label">Alterar foto</label>
        <input type="file" id="photoUpload" accept="image/*" hidden />
      </div>
      </div>
     
      <h2 id="usernameDisplay">Usu√°rio</h2>
      <p id="emailDisplay">email@exemplo.com</p>
    </aside>

    <!-- Conte√∫do principal -->
    <main class="main-content">
      <nav class="tabs">
        <button class="tab active" data-tab="perfil">Perfil</button>
        <button class="tab" data-tab="favoritos">Favoritos</button>
        <button class="tab" data-tab="carrinho">Carrinho</button>
      </nav>

      <!-- Aba: Perfil -->
      <section id="perfil" class="tab-content active">
        <h3>Meus Dados</h3>
        <br>
                  <label class="titu"><b>Nome Completo</b></label>
        <div class="inputbox">

          <p id="nomeDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Telefone</b></label>
        <div class="inputbox">
       
          <p id="telefoneDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Cidade</b></label>
        <div class="inputbox">
       
          <p id="cidadeDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Estado</b></label>
        <div class="inputbox">
       
          <p id="estadoDisplay">Carregando...</p>
        </div>
           <label class="titu"><b>Endere√ßo</b></label>
        <div class="inputbox">
       
          <p id="enderecoDisplay">Carregando...</p>
        </div>
      </section>

      <!-- Aba: Favoritos -->
      <section id="favoritos" class="tab-content">
        <h3>Favoritos</h3>
        <div id="favoritosList">Nenhum produto favoritado ainda.</div>
      </section>

      <!-- Aba: Carrinho -->
      <section id="carrinho" class="tab-content">
        <h3>Meu Carrinho</h3>
        <div id="carrinhoList">Seu carrinho est√° vazio.</div>
      </section>
    </main>
  </div>

  <script>
    // Alternar abas
    document.querySelectorAll(".tab").forEach((tab) => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach((t) => t.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach((c) => c.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });

    async function carregarPerfil() {
      try {
        const email = localStorage.getItem("userEmail");

        if (!email) {
          alert("Usu√°rio n√£o autenticado! Fa√ßa login novamente.");
          window.location.href = "login.html";
          return;
        }

        const resposta = await fetch(`http://localhost:3000/perfil/${email}`);
        if (!resposta.ok) throw new Error("Erro ao buscar dados do usu√°rio.");

        const usuario = await resposta.json();

        document.getElementById("usernameDisplay").textContent = usuario.username || "Usu√°rio";
        document.getElementById("emailDisplay").textContent = usuario.email || "E-mail n√£o informado";
        document.getElementById("nomeDisplay").textContent = usuario.nome || "-";
        document.getElementById("telefoneDisplay").textContent = usuario.telefone || "-";
        document.getElementById("cidadeDisplay").textContent = usuario.cidade || "-";
        document.getElementById("estadoDisplay").textContent = usuario.estado || "-";
        document.getElementById("enderecoDisplay").textContent = usuario.endereco || "-";

        document.getElementById("profilePhoto").src = usuario.fotoPerfil || "img/default-avatar.png";
      } catch (err) {
        console.error("Erro ao carregar perfil:", err);
        alert("N√£o foi poss√≠vel carregar os dados do perfil.");
      }
    }

    // Upload de foto
    document.getElementById("photoUpload").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const email = localStorage.getItem("userEmail");
      const formData = new FormData();
      formData.append("foto", file);

      const resposta = await fetch(`http://localhost:3000/uploadFoto/${email}`, {
        method: "POST",
        body: formData,
      });

      const resultado = await resposta.json();
      alert(resultado.message || resultado.error);
      if (resultado.url) document.getElementById("profilePhoto").src = resultado.url;
    });

    window.onload = carregarPerfil;
  </script>
</body>
</html>
